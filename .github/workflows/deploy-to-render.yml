name: Deploy to Render

on:
  push:
    branches:
      - main  # O canvia-ho si treballes amb una altra branca principal

jobs:
  deploy:
    name: Deploy Docker image to Render
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Log in to GitHub Container Registry
        run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin

      - name: Pull Docker image from GHCR
        run: docker pull ghcr.io/ignasubirachs/s05t01n01:latest

      - name: Install Render CLI
        run: |
          curl -fsSL https://render.com/install | bash
          echo "$HOME/.render" >> $GITHUB_PATH

      - name: Login to Render
        env:
          RENDER_EMAIL: ${{ secrets.RENDER_EMAIL }}
          RENDER_PASSWORD: ${{ secrets.RENDER_PASSWORD }}
        run: |
          render login --email "$RENDER_EMAIL" --password "$RENDER_PASSWORD"

      - name: Deploy to Render service
        run: |
          render services deploy BlackJack-IgnasiSubirachs
